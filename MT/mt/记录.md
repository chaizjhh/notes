## 关于Profile

Java项目的Profile分为[Maven Profile](https://maven.apache.org/guides/introduction/introduction-to-profiles.html)与[Spring Profile](https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.profiles)管理环境配置文件

```text
# Maven Profile 在pom.xml或者setting.xml或者profile.xml文件中配置
<settings>
  ...
  <activeProfiles>
    <activeProfile>profile-1</activeProfile>
  </activeProfiles>
  ...
</settings>

# Spring Profile 在application.properties中或者注解方式配置

@Configuration(proxyBeanMethods = false)
@Profile("production")
public class ProductionConfiguration {

    // ...

}

spring.profiles.active=dev,hsqldb
```

## 关于分布式锁

https://cloud.tencent.com/developer/article/1349732

‍

## 关于TP90监控计算

https://blog.csdn.net/tianyaleixiaowu/article/details/124106653

‍

‍

## 关于Mybatis集合判空

```sql
==>  Preparing: select id, rdc_id, sku_id, guarantee_days, allow_delivery_days, creator, ctime, modifier, utime, valid from rdc_sku_allot_rule_config where valid = 1 and (rdc_id, sku_id) in 
==> Parameters: 
```

如果只判断数组!=null，不判断数组的size > 0 那么就会产生以上错误的语句

```xml
        <if test="queryParamList != null and queryParamList.size > 0">
            and (rdc_id, sku_id) in
            <foreach collection="queryParamList" item="param" separator="," open="(" close=")">
                (#{param.rdcId}, #{param.skuId})
            </foreach>
        </if>
```

但是这样的话 如果queryParamList为null的话，就会查全表数据，这是致命的，改进如下

```xml
    <select id="selectByRdcAndSku" resultMap="BaseResultMap">
        select <include refid="Base_Column_List"/>
        from rdc_sku_allot_rule_config
        where valid = 1
        and (rdc_id, sku_id) in (
            <if test="queryParamList != null">
                <foreach collection="queryParamList" item="param" separator=",">
                    (#{param.rdcId}, #{param.skuId})
                </foreach>
            </if>
        )
    </select>
```

但是这样会有报错的风险，推荐使用choose方式

```xml
    <select id="selectByRdcAndSku" resultMap="BaseResultMap">
        select <include refid="Base_Column_List"/>
        from rdc_sku_allot_rule_config
        where valid = 1
          <choose>
            <when test="queryParamList != null and queryParamList.size > 0">
                <foreach collection="queryParamList" item="param" separator="," open=" and (rdc_id, sku_id) in (" close=")">
                    (#{param.rdcId}, #{param.skuId})
                </foreach>
            </when>
            <otherwise>and 1 != 1</otherwise>
          </choose>
    </select>
```

‍

## 关于Mybatis的trim标签

官网表述,MyBatis 有一个简单且适合大多数场景的解决办法。而在其他场景中，可以对其进行自定义以符合需求。而这，只需要一处简单的改动：

```xml
<select id="findActiveBlogLike"
     resultType="Blog">
  SELECT * FROM BLOG
  <where>
    <if test="state != null">
         state = #{state}
    </if>
    <if test="title != null">
        AND title like #{title}
    </if>
    <if test="author != null and author.name != null">
        AND author_name like #{author.name}
    </if>
  </where>
</select>
```

*where* 元素只会在子元素返回任何内容的情况下才插入 “WHERE” 子句。而且，若子句的开头为 “AND” 或 “OR”，*where* 元素也会将它们去除。

如果***where*** **元素与你期望的不太一样，你也可以通过自定义 trim 元素来定制** ***where*** **元素的功能。比如，和** *where* 元素等价的自定义 trim 元素为：

```xml
<trim prefix="WHERE" prefixOverrides="AND |OR ">
  ...
</trim>
```

*prefixOverrides* 属性会忽略通过管道符分隔的文本序列（注意此例中的空格是必要的）。上述例子会移除所有***prefixOverrides*** **属性中指定的内容，并且插入** *prefix* 属性中指定的内容。

‍

## 枚举遍历

在Java中，枚举类是一个声明有限实例对象的类，如果需要根据对象的属性去寻找枚举值的话，一般会通过for循环，但是for循环比较试用与数组内容及数量不确定的查找，对于这种枚举类的遍历，可直接使用switch case寻找枚举对象，可节省效率

```java
@Getter
public enum PcOverRatioConfigTypeEnum {

    ALL(-1, "全部"),
    OVER_PC(1, "PC超收"),
    OVER_3PL(2, "3PL超收");

    private final Integer code;

    private final String desc;

    PcOverRatioConfigTypeEnum(Integer code, String desc) {
        this.code = code;
        this.desc = desc;
    }

    public static PcOverRatioConfigTypeEnum getTypeEnum(String desc) {
        if (StringUtils.isBlank(desc)) {
            return null;
        }
        switch (desc) {
            case "全部":
                return ALL;
            case "PC超收":
                return OVER_PC;
            case "3PL超收":
                return OVER_3PL;
            default:
                return null;
        }
    }
}
```

‍

## Lombok

常用注解

```java
@AllArgsConstructor
@NoArgsConstructor
@Getter
@Setter
@ToString
```

建造者注解

```java
@Builder
```
