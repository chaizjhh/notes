## 计划调整审核

1. 批量审核
	1. 根据ID查询审核表
	2. 批量查询草稿表获取销量
	3. 覆盖到对应dt的草稿销量
	4. 保存草稿表
	5. 修改为已审核
2. 批量驳回
	1. 批量更新审核表为驳回
3. 审核列表查询
	1. 获取当前人有权限的经营城市
	2. 获取待审核三级品类计划
	3. 查询待审核品类信息
	4. 组装返回数据

## RDC盖帽应用/撤回

1. 盖帽应用
	1. 将每个品类计划选择的周维度与日维度转换为dt数组
	2. 查询该二级品类下所有三级品类ID
	3. 组装盖帽数组
	4. 批量插入盖帽
2. 盖帽撤回
	1. 将每个品类计划选择的周维度与日维度转换为dt数组
	2. 查询该二级品类下所有的三级品类ID
	3. 组装数据数组
	4. 批量删除盖帽标记

## 品类计划管理页面查询导出

1. 二级品类查询
	1. 处理二级品类明细行
		1. 查询草稿表获取二级品类计划
		2. 获取品类计划日期数组
		3. 批量查询计划维度调整方式，rdc盖帽配置，三级品类计划审核表，快照表当日版本，历史的补全销量及比例，dt范围预测聚合数据
		4. 标记品类-dt的数据状态标识
	2. 处理二级品类合计行
		1. 汇总草稿二级品类销量，补全销量
		2. 合计行赋值
	3. 查询二级品类信息
	4. 组装返回数据
2. 三级品类查询
	1. 处理三级品类
		1. 查询草稿表获取三级品类计划
		2. 获取品类计划日期数组
		3. 批量查询计划维度调整方式、rdc盖帽配置、三级品类计划审核、快照表当日版本，历史的补全销量及比例，dt范围预测聚合数据
		4. 标记品类-dt的数据状态标识
	2. 查询三级品类对应的二级品类计划
3. 二级品类导出
	1. 查询二级品类计划
	2. 查询二级品类信息
	3. 组装返回数据
	4. 构建excel对象
	5. 根据日期交集构建excel表头
	6. 填充excel数据
	7. 上传S3并发送通知
5. 三级品类导出
	1. 查询三级品类计划
	2. 查询二级&三级品类信息
	3. 组装返回数据
	4. 构建excel对象
	5. 根据日期交集构建excel表头
	6. 填充excel数据
	7. 上传S3并发送通知

## 品类计划看板

1. 品类计划看板查询
	1. 查询版本表历史日期的最终版本ID
	2. 根据版本ID获取品类计划
	3. 品类计划分组
	4. 查询实际销量与占比
	5. 填充并计算销量及销量占比的准确率
	6. 查询品类信息
	7. 组装品类计划看板列表
2. 品类看板导出
	1. 根据导出条件查询品类计划看板数据
	2. 构建excel对象
	3. 根据日期交集构建excel表头
	4. 填充excel数据
	5. 上传S3并发送通知

## 品类计划配置

1. 查询城市阈值配置
	1. 查询配置表
	2. 查询城市信息
	3. 组装返回数据
2. 新增城市阈值配置
	1. 查询城市维度配置
	2. 构建保存对象
	3. 上报日志
3. 调整城市阈值配置
	1. 查询城市阈值
	2. 城市阈值比对检查
	3. 修改城市阈值配置
	4. 上报日期
4. 查询城市+品类阈值配置
	1. 查询二/三级品类计划配置
	2. 判断品类等级
	3. 查询品类信息&经营城市信息
	4. 填充品类信息&经营城市
5. 导入城市+品类阈值配置
	1. 校验excel数据
	2. 校验经营城市
	3. 校验业务分组
	4. 校验品类
	5. 批量查询DB，内存对比DB数据
	6. 组装数据卡对象
	7. 更新或查询
	8. 上报日志
6. 导出城市+品类阈值配置
	10. 查询城市+品类阈值配置
	11. 构建Excel并填充
	12. 上传S3并发送通知
7. 删除城市+品类阈值配置
	1. 依据所选配置ID查询配置
	2. 校验是否允许删除
	3. 批量删除配置
8. 查询销售-订货口径转换系数
	1. 查询配置表获取转换系数
	2. 查询品类信息
	3. 查询经营城市信息
	4. 查询历史四周销售转换系数
	5. 填充数据
9. 导入销售-订货口径转换系数
	1. 校验excel数据
	2. 校验品类信息
	3. 校验经营城市信息
	4. 校验业务分组信息
	5. 批量查询DB，内存对比DB数据
	6. 组装数据卡对象
	7. 更新或查询
	8. 上报日志
10. 导出销售-订货口径转换系数
	1. 查询销售-订货口径系数配置
	2. 构建Excel并填充
	3. 上传S3并发送通知
11. 查询计划调整维度管理
	1. 查询计划调整维度配置
	2. 计算每周起止日期
	3. 查询经营城市信息
	4. 填充数据并返回
12. 导入计划调整维度管理
	1. 校验excel数据、
	2. 校验经营城市信息
	3. 校验业务分组信息
	4. 批量查询DB，内存对比DB数据
	5. 组装数据卡对象
	6. 更新或查询
	7. 上报日志
13. 导出计划调整维度管理
	1. 查询计划调整维度管理配置
	2. 构建Excel并填充数据
	3. 上传S3并发送通知
14. 批量新增计划调整维度管理
	1. 查询是否存在城市+业务分组调整方式
	2. 构建db对象
	3. 批量插入
	4. 上报日志
15. 配置日志
	1. 根据配置模块+子模块+ID查询日志
	2. 日志内容解析为展示对象
	3. 组装数据并返回

## 对外接口

1. fdc盖帽接口
	1. 查询城市+业务分组最新快照版本
	2. 查询三级品类快照品类计划
	3. 筛选锁定日志三级品类
	4. 转换为品类+dt结构
	5. 返回数据
2. rdc盖帽接口
	1. 查询城市+业务分组最新快照版本
	2. 查询三级品类快照品类计划
	3. 查询是否配置RDC盖帽
	4. 过滤数据
	4. 转换为品类+dt结构
	5. 返回数据

## 对外依赖

1. 品类/sku/预测&补全/实际销量
	1. 数据同步任务&查询Cellar接口
	2. 查询Cellar的历史日期的品类/sku预测数据，补全/实际销量
	3. 查询算法未来日期的品类/sku预测
	4. 组装数据
3. 历史四周的销售转换系数
	1. 数据同步任务&查询Cellar接口
	2. 查询Cellar历史的销售转换系数
	3. 查询算法未来日期的品类/sku预测
	4. 组装数据




