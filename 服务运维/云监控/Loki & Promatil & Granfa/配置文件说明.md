
> loki-config.yaml

```yaml
# ========== 基础配置 ==========
auth_enabled: false   # 是否启用认证，生产环境通常使用反向代理认证

server:
  http_listen_port: 3100      # HTTP 端口
  grpc_listen_port: 9096      # gRPC 端口
  http_listen_address: 0.0.0.0
  grpc_listen_address: 0.0.0.0
  log_level: info             # 日志级别（debug/info/warn/error）
  log_format: logfmt          # 支持 json/logfmt

# ========== 存储相关 ==========
common:
  instance_addr: 127.0.0.1              # 实例地址
  path_prefix: /loki                    # 持久化目录
  replication_factor: 1                # 副本数（仅限集群模式）
  storage:
    filesystem:
      chunks_directory: /loki/chunks   # 本地块存储路径
      rules_directory: /loki/rules     # 本地规则存储路径

  ring:
    kvstore:
      store: inmemory                  # 环数据存储方式：inmemory, etcd, consul

# ========== 日志解析模块 ==========
ingester:
  wal:
    enabled: true
    dir: /loki/wal
  lifecycler:
    ring:
      kvstore:
        store: inmemory
      replication_factor: 1
    final_sleep: 0s
  chunk_idle_period: 5m
  chunk_block_size: 262144
  max_chunk_age: 1h
  max_transfer_retries: 0

# ========== 日志查询模块 ==========
querier:
  engine:
    timeout: 1m
  query_ingesters_within: 2h
  max_concurrent: 20

query_range:
  align_queries_with_step: true
  max_retries: 5
  parallelise_shardable_queries: true
  cache_results: true
  split_queries_by_interval: 15m

frontend:
  log_queries_longer_than: 5s
  compress_responses: true

frontend_worker:
  frontend_address: loki:9095  # 与 frontend 模块通信地址

# ========== schema 配置 ==========
schema_config:
  configs:
    - from: 2023-01-01
      store: boltdb-shipper
      object_store: filesystem
      schema: v11
      index:
        prefix: index_
        period: 24h

# ========== 本地索引 & 块存储 ==========
storage_config:
  boltdb_shipper:
    active_index_directory: /loki/index
    cache_location: /loki/cache
    shared_store: filesystem
  filesystem:
    directory: /loki/chunks

# ========== 限制控制（防止 Loki 被滥用）==========
limits_config:
  volume_enabled: true # 获取某个租户在存储系统中占用的指标量/存储体积。监控成本与资源使用
  reject_old_samples: true
  reject_old_samples_max_age: 72h
  max_query_lookback: 72h
  max_query_length: 720h
  max_query_parallelism: 32
  ingestion_rate_mb: 32 # 每秒最大摄取 10MB 日志（可调大）
  ingestion_burst_size_mb: 64 # 峰值突发缓存，建议 >= rate
  per_stream_rate_limit: 3MB
  per_stream_rate_limit_burst: 15MB

# ========== 规则评估器（用于告警）==========
ruler:
  alertmanager_url: http://localhost:9093
  enable_alertmanager_v2: true
  evaluation_interval: 30s
  poll_interval: 30s
  rule_path: /loki/rules
  ring:
    kvstore:
      store: inmemory

# ========== chunk 相关设置 ==========
chunk_store_config:
  max_look_back_period: 72h

# ========== 表清理相关 ==========
table_manager:
  retention_deletes_enabled: true
  retention_period: 72h
```


> Promtail-Config.yaml

```yaml

# Promtail 最全配置模板（含中文注释）

server:
  http_listen_port: 9080      # Promtail 本地 HTTP 端口（用于 Promtail 自身 metrics 和健康检查）
  grpc_listen_port: 0         # 若不需要 gRPC 服务则设置为 0
  log_level: info             # 日志级别（可选：debug, info, warn, error）

positions:
  filename: /tmp/positions.yaml    # 存储上次读取日志的偏移量位置（保证重启后不会重复读取）

clients:
  - url: http://localhost:3100/loki/api/v1/push   # Loki 接收地址（注意公网采集需改为 http://公网IP:3100/...）
    batchwait: 1s                   # 最长等待 1s 才批量发送
    batchsize: 1048576              # 批量发送的最大字节数（1MB）
    backoff_config:
      minbackoff: 500ms            # 最小重试间隔
      maxbackoff: 5s               # 最大重试间隔
      maxretries: 10               # 最大重试次数

scrape_configs:
  - job_name: system-logs          # 自定义任务名
    static_configs:
      - targets:
          - localhost              # Loki 需要这个字段，内容可随意
        labels:
          job: system              # 自定义 job 名称（用于 Loki 查询）
          host: my-server          # 可加主机标识（适合多主机采集）
          env: prod                # 可加环境标签
          __path__: /var/log/*.log   # 要采集的日志路径（可使用通配符）

  - job_name: jeecg-java-logs
    static_configs:
      - targets:
          - localhost
        labels:
          job: jeecg
          app: jeecgboot
          env: prod
          __path__: /data/logs/jeecg-boot-logs/*.log

# pipeline_stages 可以做日志格式解析、提取字段、drop日志等高级处理
# 以下是一个常见 pipeline 示例（可选）
# pipeline_stages:
#   - regex:
#       expression: 'ts=(?P<timestamp>.+) level=(?P<level>\w+) msg="(?P<message>.+)"'
#   - labels:
#       level:
#   - timestamp:
#       source: timestamp
#       format: RFC3339

```